<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <title>Param√®tres Sub Goal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #181818;
      color: #ffd75e;
      padding: 2em;
      display: flex;
      flex-direction: column;
      align-items: center;
      min-height: 100vh;
    }

    h2 {
      margin-top: 0;
    }

    form {
      width: 100%;
      max-width: 550px;
      background: #232323;
      padding: 1.5em;
      border-radius: 10px;
      box-shadow: 0 2px 8px #0006;
      margin-bottom: 1em;
    }

    .level,
    .conversion {
      background: #2e2e2e;
      margin-bottom: 10px;
      padding: 0.8em;
      border-radius: 6px;
    }

    label {
      display: block;
      margin-bottom: 0.3em;
    }

    input[type="text"],
    input[type="number"] {
      width: 100%;
      padding: 0.4em;
      border-radius: 5px;
      border: none;
      margin-bottom: 0.6em;
      background: #333;
      color: #ffd75e;
    }

    button {
      padding: 0.6em 1em;
      border: none;
      border-radius: 5px;
      background: #ffd75e;
      color: #232323;
      font-weight: bold;
      cursor: pointer;
      margin: 0.3em;
      transition: background 0.2s;
    }

    button:hover {
      background: #ffe28a;
    }

    button.deleteBtn {
      background: #d32f2f;
      color: white;
      margin-top: 0.5em;
      width: 100%;
    }

    button.deleteBtn:hover {
      background: #f44336;
    }

    #link {
      display: none;
      background: #333;
      padding: 0.6em;
      border-radius: 5px;
      color: white;
      word-break: break-all;
      max-width: 95vw;
    }

    #preview-container {
      width: 100%;
      max-width: 550px;
      margin-top: 10px;
    }

    #preview-bar {
      width: 100%;
      height: 25px;
      background-color: rgba(255, 255, 255, 0.3);
      border-radius: 10px;
      overflow: hidden;
      position: relative;
    }

    #preview-pulse-wrapper {
      position: absolute;
      inset: 0;
      animation: pulse 2s linear infinite alternate;
    }

    /* fill √† 50% + pulse */
    #preview-fill {
      position: absolute;
      left: 0;
      top: 0;
      height: 100%;
      width: 50%;
      /* 50% fix√© pour l‚Äôaper√ßu */
      border-radius: 10px;
      background: linear-gradient(90deg, #ad7d22 0%, #ffb74a 100%);  
      z-index: 2;
    }

    /* waves d‚Äôaper√ßu, calqu√©es sur wave1/wave2 r√©els */
    #preview-wave1,
    #preview-wave2 {
      position: absolute;
      inset: 0;
      z-index: 1;
      width: 40px;
      height: 50px;
      left: 50%;
      background: #ffb74a;
      border-radius: 50%;
      animation: wave 0.5s ease-in-out infinite alternate;
      transition: ease left 0.5s;
    }

    #preview-wave1 {
      top: -60%;
    }

    #preview-wave2 {
      top: -10%;
      animation-delay: -80ms;
    }

    /* m√™mes keyframes que l‚Äôoverlay */
    @keyframes wave {
      0% {
        transform: translateX(-80%);
      }

      100% {
        transform: translateX(-60%);
      }
    }

    @keyframes pulse {
      0% {
        filter: brightness(90%);
      }

      100% {
        filter: brightness(120%);
      }
    }


    #msg {
      margin-top: 0.5em;
    }
  </style>
</head>

<body>

  <h2>Configurer le Sub/Donation Goal</h2>

  <form id="settingsForm">
    <h3>Texte une fois le goal final atteint</h3>
    <div class="conversion">
      <label>Titre final affich√© :
        <input type="text" id="finalTitleInput" placeholder="Ex : Merci pour la thune !">
      </label>
    </div>
    <h3>Paliers</h3>
    <div id="levels-container"></div>
    <button type="button" id="addLevel">+ Ajouter un palier</button>

    <h3>Points par action</h3>
    <div class="conversion">
      <label>100 bits = <input type="number" id="bitsInput" min="0" step="0.1" value="1"> points</label>
      <label>1 sub = <input type="number" id="subsInput" min="0" step="0.1" value="2"> points</label>
      <label>1‚Ç¨ de don = <input type="number" id="donInput" min="0" step="0.1" value="1"> points</label>
    </div>

    <!-- NOUVEAU : Points de d√©part -->
    <h3>Configuration initiale</h3>
    <div class="conversion">
      <label>Points de d√©part :
        <input type="number" id="startPointsInput" min="0" step="0.01" value="0" placeholder="Ex: 50.00">
      </label>
    </div>

    <h3>Options d‚Äôaffichage</h3>
    <div class="conversion">
      <label>
        <input type="checkbox" id="hideWavesInput">
        Cacher les animations de vagues
      </label>
    </div>

    <h3>Couleurs du d√©grad√©</h3>
    <div class="conversion">
      <label>Couleur 1 (d√©but) :
        <input type="color" id="gradientColor1Input" value="#ad7d22">
      </label>
      <label>Couleur 2 (fin / waves) :
        <input type="color" id="gradientColor2Input" value="#ffb74a">
      </label>
    </div>

    <button type="submit">G√©n√©rer le lien</button>
  </form>

  <button id="copyBtn" style="display:none;">Copier le lien</button>
  <div id="msg"></div>
  <a id="link" href="#" target="_blank"></a>

  <h3>Aper√ßu (50%)</h3>
  <div id="preview-container">
    <div id="preview-bar">
      <div id="preview-pulse-wrapper">
        <div id="preview-wave1"></div>
        <div id="preview-wave2"></div>
        <div id="preview-fill"></div>
      </div>
    </div>
  </div>



  <script>
    const levelsContainer = document.getElementById("levels-container");
    const addButton = document.getElementById("addLevel");
    const linkEl = document.getElementById("link");
    const msgEl = document.getElementById("msg");

    const gradientColor1Input = document.getElementById("gradientColor1Input");
    const gradientColor2Input = document.getElementById("gradientColor2Input");
    const hideWavesInput = document.getElementById("hideWavesInput");
    const finalTitleInput = document.getElementById("finalTitleInput");

    const previewFill = document.getElementById("preview-fill");
    const previewWave1 = document.getElementById("preview-wave1");
    const previewWave2 = document.getElementById("preview-wave2");

    function updatePreview() {
      const c1 = gradientColor1Input.value || "#ad7d22";
      const c2 = gradientColor2Input.value || "#ffb74a";

      // Filler = gradient entre c1 et c2
      previewFill.style.background = `linear-gradient(90deg, ${c1} 0%, ${c2} 100%)`;

      // Waves = deuxi√®me couleur du filler
      previewWave1.style.backgroundColor = c2;
      previewWave2.style.backgroundColor = c2;

      // Affichage / masquage des waves
      const hide = hideWavesInput.checked;
      previewWave1.style.display = hide ? "none" : "block";
      previewWave2.style.display = hide ? "none" : "block";
    }

    // √âcoute les changements
    gradientColor1Input.addEventListener("input", updatePreview);
    gradientColor2Input.addEventListener("input", updatePreview);
    hideWavesInput.addEventListener("change", updatePreview);

    // Init au chargement
    updatePreview();

    let levels = [
      { name: "Palier 1 : D√©collage", target: 100 },
      { name: "Palier 2 : Propulsion", target: 300 }
    ];

    // ---- G√âN√âRATION DES INPUTS DES PALIERS ----
    function renderLevels() {
      levelsContainer.innerHTML = "";
      levels.forEach((lvl, i) => {
        const div = document.createElement("div");
        div.className = "level";
        div.innerHTML = `
          <label>Nom du palier ${i + 1}:
            <input type="text" data-index="${i}" data-field="name" value="${lvl.name}">
          </label>
          <label>Objectif (points):
            <input type="number" data-index="${i}" data-field="target" min="1" value="${lvl.target}">
          </label>
          <button type="button" class="deleteBtn" data-index="${i}">üóëÔ∏è Supprimer ce palier</button>
        `;
        levelsContainer.appendChild(div);
      });
    }

    addButton.onclick = () => {
      levels.push({ name: "Nouveau palier", target: 100 });
      renderLevels();
    };

    levelsContainer.addEventListener("input", (e) => {
      const i = e.target.dataset.index;
      const field = e.target.dataset.field;
      levels[i][field] = e.target.value;
    });

    // Suppression des paliers
    levelsContainer.addEventListener("click", (e) => {
      if (e.target.classList.contains("deleteBtn")) {
        const index = parseInt(e.target.dataset.index);
        if (levels.length > 1) {
          levels.splice(index, 1);
          renderLevels();
        } else {
          alert(" Vous devez garder au moins 1 palier !");
        }
      }
    });

    // ---- G√âN√âRATION DU LIEN ----
    document.getElementById("settingsForm").onsubmit = (e) => {
      e.preventDefault();

      // Validation des paliers
      for (let i = 1; i < levels.length; i++) {
        if (levels[i].target < levels[i - 1].target) {
          msgEl.textContent = ` Erreur : Palier ${i + 1} (${levels[i].target}) doit √™tre >= Palier ${i} (${levels[i - 1].target})`;
          msgEl.style.color = "red";
          return;
        }
      }

      const points = {
        bits: parseFloat(document.getElementById("bitsInput").value),
        sub: parseFloat(document.getElementById("subsInput").value),
        donation: parseFloat(document.getElementById("donInput").value)
      };

      const startPoints = parseFloat(document.getElementById("startPointsInput").value) || 0;
      const finalTitle = finalTitleInput.value || "";

      const encodedLevels = encodeURIComponent(JSON.stringify(levels));
      const encodedPoints = encodeURIComponent(JSON.stringify(points));
      const gradient = {
        c1: gradientColor1Input.value || "#ad7d22",
        c2: gradientColor2Input.value || "#ffb74a"
      };

      const options = {
        hideWaves: hideWavesInput.checked
      };

      const encodedGradient = encodeURIComponent(JSON.stringify(gradient));
      const encodedOptions = encodeURIComponent(JSON.stringify(options));
      const encodedFinalTitle = encodeURIComponent(finalTitle);

      let base = window.location.origin + window.location.pathname;
      base = base.replace(/settings\/index\.html$/, '').replace(/settings\/$/, '');
      const url = `${base}?levels=${encodedLevels}&points=${encodedPoints}&startPoints=${startPoints}&gradient=${encodedGradient}&options=${encodedOptions}&finalTitle=${encodedFinalTitle}`;

      linkEl.href = url;
      linkEl.textContent = url;
      linkEl.style.display = "block";
      document.getElementById("copyBtn").style.display = "inline-block";
      msgEl.textContent = "Copiez ce lien dans OBS ou votre navigateur !";
    };


    // ---- BOUTON COPIE ----
    document.getElementById("copyBtn").onclick = () => {
      const text = linkEl.textContent;
      navigator.clipboard.writeText(text).then(() => {
        msgEl.textContent = "Lien copi√© !";
      }).catch(() => {
        msgEl.textContent = "Erreur lors de la copie.";
      });
    };

    renderLevels();
  </script>
</body>

</html>